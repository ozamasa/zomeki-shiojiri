<div id="map_canvas" style="height: 350px; width: 700px;"></div>

<%= javascript_include_tag 'http://maps.googleapis.com/maps/api/js?sensor=false' %>
<%= javascript_include_tag '/_common/modules/map/js/map.js' %>
<%= javascript_tag do -%>
var map;
google.maps.event.addDomListener(window, 'load', function (event) {
  map = new Map('map_canvas', <%= @markers.first.try(:latitude) || 0 %>, <%= @markers.first.try(:longitude) || 0 %>);
  <%- @markers.each do |marker| -%>
    map.set_marker('<%= "#{marker.latitude}_#{marker.longitude}" %>', <%= marker.latitude %>, <%= marker.longitude %>, '<%= marker.title %>',
                   '<%=raw simple_format(marker.window_text, {}, sanitize: false).gsub(/\r|\n/, '') %>');
  <%- end -%>
});
<%- end -%>

<%- unless @markers.empty? -%>
<table>
  <%- @markers.each do |marker| -%>
  <tr>
    <td><%= marker.title %></td>
    <td><%= link_to_function '移動', "map.move_to('#{marker.latitude}_#{marker.longitude}')" %></td>
  </tr>
  <%- end -%>
</table>
<%- end -%>
