<%
  #カレンダーの先頭曜日の指定（0:日曜、1:月曜、、、6:土曜)
  start_w_index = @start_wday

  #カレンダーの開始日が何曜日でも良いように２週分用意しておく
  wday=[{:name=>'日',:num=>0,:class =>"wday sun"},{:name=>'月',:num=>1,:class=>"wday mon"},{:name=>'火',:num=>2,:class=>"wday tue"},
	{:name=>'水',:num=>3,:class=>"wday wed"},{:name=>'木',:num=>4,:class=>"wday thu"},{:name=>'金',:num=>5,:class=>"wday fri"},
	{:name=>'土',:num=>6,:class=>"wday sat"},
	{:name=>'日',:num=>0,:class =>"wday sun"},{:name=>'月',:num=>1,:class=>"wday mon"},{:name=>'火',:num=>2,:class=>"wday tue"},
	{:name=>'水',:num=>3,:class=>"wday wed"},{:name=>'木',:num=>4,:class=>"wday thu"},{:name=>'金',:num=>5,:class=>"wday fri"}]

	max_row = 5
	max_column = 7 - 1
%>

<div class="calendarEvents calendarMonthlyEvents">

<h2><%= sprintf("%d年%d月", @year, @month) %></h2>

<%= @pagination.to_links(:class => "pagination upperPagination") %>

<table border="1">
  <thead class="wdays">
  <tr>
	<% 0.upto(6) do |idx| %>
	  <th class="<%= wday[start_w_index + idx][:class] %>"><%= wday[start_w_index + idx][:name]%></th>
	<% end %>
  </tr>
  </thead>
  <% 0.upto(max_row) do |row| %>
  <tr>
	<% 0.upto(max_column) do |column| %>
	<td style="border:1px solid gray;height:80px;">
	  <% the_day = @box[row][column] %>
	  <%= the_day[:date].strftime("%Y %m %d") %>
	  <% the_day[:events].each do |item| %>
		<%= item.event_uri.blank? ? hbr(item.title) : link_to(hbr(item.title), item.event_uri, :target => "_blank") %>
	  <% end %>
	</td>
	<%  end %>
  </tr>
  <% end %>
</table>

<p/>
<hr>
<p/>

<table border="1">
  <% @calendar.days.each do |day| %><% next if day[:class] =~ /(next|prev)/ %>
  <tr class="date" id="day<%= sprintf('%02d', day[:day]) %>">
    <th class="<%= day[:class] %>">
      <%= day[:day] %>日（<%= day[:wday_label] %>）
    </th>
    <td>
    <% if @items[day[:date]].size > 0 || day[:holiday] %><ul class="events">
      <% if day[:holiday] %><li class="holiday"><%= day[:holiday] %></li><% end %>
      <% @items[day[:date]].each do |item| %>
        <% if item.is_a?(Article::Doc) %>
          <li class="event"><%= link_to item.title, item.public_uri %></li>
        <% elsif item.is_a?(PortalArticle::Doc) %>
          <% if @doc_content_type == :portal && @content.setting_value(:docs_list_type) == 'list' %>
            <%= portal_group_doc_view item, @content.setting_value(:docs_list_type) %>
          <% elsif @doc_content_type == :portal %>
            <li class="event"><%= portal_group_doc_view item, @content.setting_value(:docs_list_type) %></li>
          <% elsif @content.setting_value(:docs_list_type) == 'list' %>
            <%= portal_article_doc_view item, @content.setting_value(:docs_list_type) %>
          <% else %>
            <li class="event"><%= portal_article_doc_view item, @content.setting_value(:docs_list_type) %></li>
          <% end %>
        <% else %>
          <li class="event"><%= item.event_uri.blank? ? hbr(item.title) : link_to(hbr(item.title), item.event_uri, :target => "_blank") %></li>
        <% end %>
      <% end %>
    </ul><% else %>&nbsp;<% end %>
    </td>
  </tr>
  <% end %>
</table>


<%= @pagination.to_links(:class => "pagination lowerPagination") %>

<!-- end .calendarEvents --></div>
